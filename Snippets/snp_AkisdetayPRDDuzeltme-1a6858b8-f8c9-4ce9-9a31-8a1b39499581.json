{
  "id": "1a6858b8-f8c9-4ce9-9a31-8a1b39499581",
  "prefix": "snp_AkisdetayPRDDuzeltme",
  "description": "",
  "body": "Declare @PlanID int,@RotaSiraNo int,@RotaID int,@CikanUrunTID int, @StokIslemAkisID int, @PRMIslemAkisMID int,\n@SIAIslemAkisMID int,@SIAPPAciklama varchar(1000) ,@SIAPPPickUpYuzde decimal(18,6),@SIAPPProsesParamMID int,@SIAPPReceteID int\nDeclare c Cursor Local For\n\nSELECT PRD.PlanID,PRD.RotaSiraNo,PRM.RotaID,PRM.CikanUrunTID,SIA.StokIslemAkisID,PRM.IslemAkisMID FROM IT05_PartiRotaD PRD\nINNER JOIN IT05_PartiRotaM PRM On PRM.IsEmriNo = PRD.IsEmriNo\nINNER JOIN IT05_PartiRotaM_MamulKumas PRMMK On PRMMK.IsEmriNo = PRM.IsEmriNo\nINNER JOIN IT05_PlanMakina PM On PM.PlanID = PRD.PlanID\nINNER JOIN IT06_Stoklar_MamulKumas SMK On SMK.UrunTID = PRM.CikanUrunTID\nINNER JOIN IT06_StoklarIslemAkis SIA On SIA.StokIslemAkisID = SMK.StokIslemAkisID\nWhere PRD.IsEmriNo In (\n\t\t\t\t\t\tSELECT PRD.IsEmriNo FROM IT05_PartiRotaD PRD\n\t\t\t\t\t\tINNER JOIN IT05_UretimPartileri UP On UP.UretimPartiID = PRD.UretimPartiID\n\t\t\t\t\t\tINNER JOIN IT05_PartiRotaM_MamulKumas PRMMK On PRMMK.UretimPartiID = PRD.UretimPartiID \n\t\t\t\t\t\tWhere PRD.Durumu In (0,1)\n)\nOrder By PRD.IsEmriNo ,PRD.RotaSiraNo\n\t\t\nOpen c\nFetch Next From c Into @PlanID,@RotaSiraNo,@RotaID,@CikanUrunTID,@StokIslemAkisID,@PRMIslemAkisMID\nWhile @@FETCH_STATUS = 0 Begin\n\n\n\t\t\t\tDeclare cc Cursor Local For\n\n\t\t\t\tSelect  SIA.IslemAkisMID, SIAPP.Aciklama, SIAPP.PickUpYuzde, SIAPP.ProsesParamMID, SIAPP.ReceteID FROM  IT06_Stoklar_MamulKumas SMK\n\t\t\t\tINNER JOIN IT06_StoklarIslemAkis SIA On SIA.StokIslemAkisID = SMK.StokIslemAkisID\n\t\t\t\tINNER JOIN IT06_StoklarIslemAkis_ProsesParam SIAPP On SIAPP.StokIslemAkisID = SIA.StokIslemAkisID\n\t\t\t\tINNER JOIN IT05_RotaD RD On RD.SiraNo = SIAPP.SiraNo \n\t\t\t\tWhere  RD.SiraNo =  @RotaSiraNo And RD.RotaID = @RotaID And SMK.UrunTID = @CikanUrunTID\n\t\t\t\n\t\t\t\tOpen cc\n\t\t\t\tFetch Next From cc Into @SIAIslemAkisMID,@SIAPPAciklama,@SIAPPPickUpYuzde,@SIAPPProsesParamMID,@SIAPPReceteID\n\t\t\t\tWhile @@FETCH_STATUS = 0 Begin\n\n\t\t\t\t\tIf @StokIslemAkisID  <> -1 And @SIAIslemAkisMID = @PRMIslemAkisMID  Begin /*Tip kodundaki akış ile iş emri oluşturulurken seçilen akış aynı ise çalışacaktır...*/\n\t\t\t\t\t\tUpdate IT05_PartiRotaD Set ProsesParamMID = @SIAPPProsesParamMID, Aciklama = @SIAPPAciklama, IsITUpdate = IsITUpdate  Where PlanID = @PlanID  And ISNULL(Aciklama,'') <> ISNULL(@SIAPPAciklama,'') And ProsesID Not in (63,77)\n\t\t\t\t\tEnd\n\t\n\t\t\t\t\tFetch Next From cc Into @SIAIslemAkisMID,@SIAPPAciklama,@SIAPPPickUpYuzde,@SIAPPProsesParamMID,@SIAPPReceteID\n\t\t\t\tEnd\n\t\t\t\tClose cc\n\t\t\t\tDeallocate cc\n\n\n\tFetch Next From c Into @PlanID,@RotaSiraNo,@RotaID,@CikanUrunTID,@StokIslemAkisID,@PRMIslemAkisMID\nEnd\nClose c\nDeallocate c\n\t\n\t\n\n\n"
}