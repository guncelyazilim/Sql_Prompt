{
  "id": "48cd27aa-7829-4f60-b960-c3f0d2618722",
  "prefix": "manuelnewkomppppp",
  "description": "",
  "body": "---Elyaf \n\n\n\n\nDeclare @UrunTID int, @KompozisyonID int,@NewKompozisyonID int\nDeclare @TN T01_ElyafYuzde_AB\nDeclare c Cursor Local For\nSELECT S.UrunTID,S.KompozisyonID FROM  IT06_Stoklar S \nINNER JOIN IT06_Stoklar_Elyaf SE On SE.UrunTID = S.UrunTID\nLEFT OUTER JOIN  IT01_NewKompozisyon NK On NK.NewKompozisyonID = S.NewKompozisyonID\nWhere   s.KompozisyonID Is Not Null And  S.NewKompozisyonID Is not Null And NK.UrunKompozisyonAdi Is Null And \n  S.UrunTID Not In (SELECT SH.UrunTID FROM  IT06_StokHammadde SH) \n\nOpen c\nFetch Next From c Into @UrunTID,@KompozisyonID\nWhile @@FETCH_STATUS = 0 Begin\n\n\t\tInsert @TN ( Grup, ElyafID, ElyafKodu, ElyafAdi, ElyafYuzde, IsKarisimElyaf, IsKompGorunmesiZorunlu, ElyafYuzde2)\n\t\t\n\n\n\t\tSelect  'A',T.ElyafID,E.ElyafKodu,E.ElyafAdi, T.Yuzdesi, 0,E.IsKompGorunmesiZorunlu,T.Yuzdesi \n\t\tFrom\tIT01_KompozisyonElyaflari T,IT01_Elyaflar E\n\t\tWhere\tT.ElyafID = E.ElyafID And T.KompozisyonID = @KompozisyonID\n\n\t\tUnion\n\t\t \n\t\tSelect  'B',MAX(T.ElyafID),E.ElyafKodu,E.ElyafAdi, SUM(T.Yuzdesi), 0,E.IsKompGorunmesiZorunlu,SUM(T.Yuzdesi) \n\t\tFrom\tIT01_KompozisyonElyaflari T,IT01_Elyaflar E\n\t\tWhere\tT.ElyafID = E.ElyafID And T.KompozisyonID = @KompozisyonID\n\t\tGroup By E.ElyafKodu,E.ElyafAdi,E.IsKompGorunmesiZorunlu\n\n\t\t\n\nExec SP01_NewKompozisyon @TMPManuelElyaf = @TN, @UrunTID = null, @NewKompozisyonID = @NewKompozisyonID Output\n\nUpdate IT06_Stoklar Set  NewKompozisyonID = @NewKompozisyonID Where UrunTID = @UrunTID\t\n\nDelete @TN\t\n\n\tFetch Next From c Into @UrunTID,@KompozisyonID\nEnd\nClose c\nDeallocate c\n\n\n\n\n\n--- FİTİL\n\nDeclare @UrunTID int\nDeclare c Cursor Local For\nSELECT  S.UrunTID FROM  IT06_Stoklar S \nINNER JOIN IT06_Stoklar_Fitil SF On SF.UrunTID = S.UrunTID\nLEFT OUTER JOIN  IT01_NewKompozisyon NK On NK.NewKompozisyonID = S.NewKompozisyonID\nWhere S.KompozisyonID is Not Null And S.NewKompozisyonID Is not Null And NK.UrunKompozisyonAdi Is Null  \n\nOpen c\nFetch Next From c Into @UrunTID\nWhile @@FETCH_STATUS = 0 Begin\n\nExec PSP06_OUK_Fitil_Kompozisyon @UrunTID = @UrunTID\n\t\t\n\n\tFetch Next From c Into @UrunTID\nEnd\nClose c\nDeallocate c\n\n--İPLİK \n\n\nDeclare @UrunTID int\nDeclare c Cursor Local For\nSELECT  S.UrunTID FROM  IT06_Stoklar S \nINNER JOIN IT06_Stoklar_Iplik SI On SI.UrunTID = S.UrunTID\nLEFT OUTER JOIN  IT01_NewKompozisyon NK On NK.NewKompozisyonID = S.NewKompozisyonID\nWhere s.KompozisyonID Is Not Null And S.NewKompozisyonID Is not Null And S.UrunTID In (SELECT SH.UrunTID FROM  IT06_StokHammadde SH)\nAnd NK.UrunKompozisyonAdi Is Null \n\nOpen c\nFetch Next From c Into @UrunTID\nWhile @@FETCH_STATUS = 0 Begin\n\n\nExec PSP06_OUK_Iplik_Kompozisyon @UrunTID = @UrunTID\n\t\t\n\n\tFetch Next From c Into @UrunTID\nEnd\nClose c\nDeallocate c\n\n--satınalınan iplikler için kompozisyon oluşturulacak\n\n\nDeclare @UrunTID int, @KompozisyonID int,@NewKompozisyonID int\nDeclare @TN T01_ElyafYuzde_AB\nDeclare c Cursor Local For\nSELECT S.UrunTID,S.KompozisyonID FROM  IT06_Stoklar S \nINNER JOIN IT06_Stoklar_Iplik SI On SI.UrunTID = S.UrunTID\nLEFT OUTER JOIN  IT01_NewKompozisyon NK On NK.NewKompozisyonID = S.NewKompozisyonID\nWhere sI.UrunAgaciOnay = 1 And  s.KompozisyonID Is Not Null And  S.NewKompozisyonID Is Not  Null And\n  S.UrunTID Not In (SELECT SH.UrunTID FROM  IT06_StokHammadde SH) And  NK.UrunKompozisyonAdi Is Null\n\nOpen c\nFetch Next From c Into @UrunTID,@KompozisyonID\nWhile @@FETCH_STATUS = 0 Begin\n\n\t\tInsert @TN ( Grup, ElyafID, ElyafKodu, ElyafAdi, ElyafYuzde, IsKarisimElyaf, IsKompGorunmesiZorunlu, ElyafYuzde2)\n\t\t\n\n\n\t\tSelect  'A',T.ElyafID,E.ElyafKodu,E.ElyafAdi, T.Yuzdesi, 0,E.IsKompGorunmesiZorunlu,T.Yuzdesi \n\t\tFrom\tIT01_KompozisyonElyaflari T,IT01_Elyaflar E\n\t\tWhere\tT.ElyafID = E.ElyafID And T.KompozisyonID = @KompozisyonID\n\n\t\tUnion\n\t\t \n\t\tSelect  'B',MAX(T.ElyafID),E.ElyafKodu,E.ElyafAdi, SUM(T.Yuzdesi), 0,E.IsKompGorunmesiZorunlu,SUM(T.Yuzdesi) \n\t\tFrom\tIT01_KompozisyonElyaflari T,IT01_Elyaflar E\n\t\tWhere\tT.ElyafID = E.ElyafID And T.KompozisyonID = @KompozisyonID\n\t\tGroup By E.ElyafKodu,E.ElyafAdi,E.IsKompGorunmesiZorunlu\n\n\t\t\n\nExec SP01_NewKompozisyon @TMPManuelElyaf = @TN, @UrunTID = null, @NewKompozisyonID = @NewKompozisyonID Output\n\nUpdate IT06_Stoklar Set  NewKompozisyonID = @NewKompozisyonID Where UrunTID = @UrunTID\t\n\nDelete @TN\t\n\n\tFetch Next From c Into @UrunTID,@KompozisyonID\nEnd\nClose c\nDeallocate c\n\n------\n\n--çözgü\n\n\nDeclare @UrunTID int\nDeclare c Cursor Local For\nSELECT  S.UrunTID FROM  IT06_Stoklar S \nINNER JOIN IT06_Stoklar_Cozgu SC On SC.UrunTID = S.UrunTID\nLEFT OUTER JOIN  IT01_NewKompozisyon NK On NK.NewKompozisyonID = S.NewKompozisyonID\nWhere s.KompozisyonID Is Not Null And SC.UrunAgaciOnay  =1  And  S.NewKompozisyonID Is Not Null And  NK.UrunKompozisyonAdi Is Null\n\nOpen c\nFetch Next From c Into @UrunTID\nWhile @@FETCH_STATUS = 0 Begin\n\nExec PSP06_OUK_Cozgu_Kompozisyon @UrunTID = @UrunTID\n\t\t\n\n\tFetch Next From c Into @UrunTID\nEnd\nClose c\nDeallocate c\n\n---hamkumaş \n\nDeclare @UrunTID int\nDeclare c Cursor Local For\nSELECT  S.UrunTID FROM  IT06_Stoklar S \nINNER JOIN IT06_Stoklar_HamKumas  SHK On SHK.UrunTID = S.UrunTID\nLEFT OUTER JOIN  IT01_NewKompozisyon NK On NK.NewKompozisyonID = S.NewKompozisyonID\nWhere SHK.UrunAgaciOnay = 1 And S.KompozisyonID Is Not Null And S.NewKompozisyonID Is Not Null And S.UrunTID In (SELECT SH.UrunTID FROM  IT06_StokHammadde SH) And NK.UrunKompozisyonAdi Is Null\n\nOpen c\nFetch Next From c Into @UrunTID\nWhile @@FETCH_STATUS = 0 Begin\n\n--Exec PSP06_OUK_HamKumas_UrunAgaciOnayIptal  @UrunTID = @UrunTID, @UrunAgaciOnay = null\n\n--Exec PSP06_OUK_HamKumas_UrunAgaciOnay @UrunTID = @UrunTID\n\n\nExec PSP06_OUK_HamKumas_Kompozisyon @UrunTID = @UrunTID\n\t\t\n\n\tFetch Next From c Into @UrunTID\nEnd\nClose c\nDeallocate c\n\n--satınalınan kumaşlar için kompozisyon oluşturulacak\n\n\nDeclare @UrunTID int, @KompozisyonID int,@NewKompozisyonID int\nDeclare @TN T01_ElyafYuzde_AB\nDeclare c Cursor Local For\nSELECT S.UrunTID,S.KompozisyonID FROM  IT06_Stoklar S \nINNER JOIN IT06_Stoklar_HamKumas SHK On SHK.UrunTID = S.UrunTID\nLEFT OUTER JOIN  IT01_NewKompozisyon NK On NK.NewKompozisyonID = S.NewKompozisyonID\nWhere  SHK.UrunAgaciOnay = 1 And s.KompozisyonID Is Not Null And S.NewKompozisyonID Is Not Null And\n  S.UrunTID Not In (SELECT SH.UrunTID FROM  IT06_StokHammadde SH) And NK.UrunKompozisyonAdi Is Null\n\nOpen c\nFetch Next From c Into @UrunTID,@KompozisyonID\nWhile @@FETCH_STATUS = 0 Begin\n\n\t\tInsert @TN ( Grup, ElyafID, ElyafKodu, ElyafAdi, ElyafYuzde, IsKarisimElyaf, IsKompGorunmesiZorunlu, ElyafYuzde2)\n\t\t\n\n\n\t\tSelect  'A',T.ElyafID,E.ElyafKodu,E.ElyafAdi, T.Yuzdesi, 0,E.IsKompGorunmesiZorunlu,T.Yuzdesi \n\t\tFrom\tIT01_KompozisyonElyaflari T,IT01_Elyaflar E\n\t\tWhere\tT.ElyafID = E.ElyafID And T.KompozisyonID = @KompozisyonID\n\n\t\tUnion\n\t\t \n\t\tSelect  'B',MAX(T.ElyafID),E.ElyafKodu,E.ElyafAdi, SUM(T.Yuzdesi), 0,E.IsKompGorunmesiZorunlu,SUM(T.Yuzdesi) \n\t\tFrom\tIT01_KompozisyonElyaflari T,IT01_Elyaflar E\n\t\tWhere\tT.ElyafID = E.ElyafID And T.KompozisyonID = @KompozisyonID\n\t\tGroup By E.ElyafKodu,E.ElyafAdi,E.IsKompGorunmesiZorunlu\n\n\t\t\n\nExec SP01_NewKompozisyon @TMPManuelElyaf = @TN, @UrunTID = null, @NewKompozisyonID = @NewKompozisyonID Output\n\nUpdate IT06_Stoklar Set  NewKompozisyonID = @NewKompozisyonID Where UrunTID = @UrunTID\t\n\nDelete @TN\t\n\n\tFetch Next From c Into @UrunTID,@KompozisyonID\nEnd\nClose c\nDeallocate c\n\n--mamül kumaşlar için \n\n\nDeclare @UrunTID int\nDeclare c Cursor Local For\nSELECT  S.UrunTID FROM  IT06_Stoklar S \nINNER JOIN IT06_Stoklar_MamulKumas SMK On SMK.UrunTID = S.UrunTID\nLEFT OUTER JOIN IT06_StoklarIslemAkis SIA On SIA.StokIslemAkisID = SMK.StokIslemAkisID\nLEFT OUTER JOIN  IT01_NewKompozisyon NK On NK.NewKompozisyonID = S.NewKompozisyonID\nWhere SMK.UrunAgaciOnay = 1 And S.KompozisyonID Is Not Null And S.NewKompozisyonID  Is Not Null And S.UrunTID In (SELECT SH.UrunTID FROM  IT06_StokHammadde SH) And NK.UrunKompozisyonAdi Is Null\n\nOpen c\nFetch Next From c Into @UrunTID\nWhile @@FETCH_STATUS = 0 Begin\n\nUpdate  IT06_Stoklar_MamulKumas Set UrunAgaciOnay = 0, IsITUpdate = IsITUpdate Where UrunTID = @UrunTID\n\nExec PSP06_OUK_MamulKumas_UrunAgaciOnay @UrunTID = @UrunTID\t\n\n\tFetch Next From c Into @UrunTID\nEnd\nClose c\nDeallocate c\n\nSELECT * FROM  IT07_GerCikanMalzeme GCM \nINNER JOIN  IT06_StokKarti SK On SK.UrunID = GCM.UrunID\nWhere SK.UrunTID = 12259"
}