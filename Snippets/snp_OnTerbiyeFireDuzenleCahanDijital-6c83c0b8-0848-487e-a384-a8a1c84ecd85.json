{
  "id": "6c83c0b8-0848-487e-a384-a8a1c84ecd85",
  "prefix": "snp_OnTerbiyeFireDuzenleCahanDijital",
  "description": "",
  "body": "ALTER PROCEDURE  PSP08_OnTerbiyeUrtFireYuzdeYenidenHesapla\r\nAs\r\nSet NoCount On\r\nBegin\r\n    /*\r\n\t\tYazan\t: zz_gncyzlm_obulbul\r\n\t\tTarih\t: 13.03.2023\r\n\t\tAçıklama:\r\n\t*/\r\n    Begin Try\r\n        Declare @IsEmriNo Int, @SeriID Int, @PlanID Int\r\n        Declare csnp Cursor Local For\r\n        Select  POT.IsEmriNo, POT.SeriID From   PV05_Parti_OnTerbiye POT Where  POT.OnTerbiyeUrtFire Is Null\r\n        Open csnp\r\n        Fetch Next From csnp\r\n        Into @IsEmriNo, @SeriID\r\n        While @@FETCH_STATUS = 0 Begin\r\n\r\n            Select      Top 1 @PlanID = PRD.PlanID\r\n            From        IT05_PartiRotaD PRD\r\n            Where       PRD.IsEmriNo = @IsEmriNo\r\n            Order By    PRD.RotaSiraNo Desc\r\n\r\n            Update  SM\r\n            Set     SM.Miktar_Mt = URT.UrtMt, SM.Miktar_Kg = URT.UrtKg, SM.IsITUpdate = SM.IsITUpdate,\r\n                    SM.OnTerbiyeUrtFire = IIF(dbo.F15_DivideByZero(IlkProses.UrtMt * 1.0, URT.UrtMt) < 1, 1, dbo.F15_DivideByZero(IlkProses.UrtMt * 1.0, URT.UrtMt)),\r\n                    SM.OnTerbiyeUrtFireYuzde = IIF(dbo.F15_DivideByZero((IlkProses.UrtMt - URT.UrtMt) * 1.0, IlkProses.UrtMt) < 0,\r\n                                                   0,\r\n                                                   IIF(dbo.F15_DivideByZero((IlkProses.UrtMt - URT.UrtMt) * 1.0, IlkProses.UrtMt) = 1,  /*%100 fire mümkün değil*/\r\n                                                       0,\r\n                                                       dbo.F15_DivideByZero((IlkProses.UrtMt - URT.UrtMt) * 1.0, IlkProses.UrtMt)))\r\n            From    IT08_SeriM SM\r\n                    Cross Apply(Select  PRD.UrtMt, PRD.UrtKg From   IT05_PartiRotaD PRD Where   PRD.PlanID = @PlanID) URT\r\n                    Cross Apply(Select      Top 1   PRD.UrtMt, PRD.UrtKg\r\n                                From        IT05_PartiRotaD PRD\r\n                                Where       PRD.IsEmriNo = @IsEmriNo\r\n                                Order By    PRD.RotaSiraNo) IlkProses\r\n            Where   SM.SeriID = @SeriID\r\n\r\n            Fetch Next From csnp\r\n            Into @IsEmriNo, @SeriID\r\n        End\r\n        Close csnp\r\n        Deallocate csnp\r\n\r\n    End Try\r\n    Begin Catch\r\n        Declare @ITObjectName NVarchar(126);\r\n        Set @ITObjectName = OBJECT_NAME(@@PROCID);\r\n        Execute SP15_GenerateError @ITObjectName;\r\n    End Catch\r\nEnd\r\nGO"
}