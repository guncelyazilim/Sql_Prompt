{
  "id": "bd23ee80-7440-4796-b0fa-c05adb1b88f8",
  "prefix": "snp_Merge",
  "description": "Merge: Değişiklik Yönetimi",
  "body": "Merge IT01_MasterReceteD AS T\n\t\tUSING (\t\t\t\t\n\t\t\tSelect\tRA.MasterReceteID,  ARD.AdimReceteDID, RA.AdimID, Row_Number() Over(Order By RA.SiraNo, ARD.SiraNo) As SiraNo, \n\t\t\t\tDENSE_RANK() Over(Order By RA.SiraNo, ARD.IstekNo) IstekNo,\n\t\t\t\tARD.UrunTID, ARD.BirimMiktar, ARD.ReceteOlcuBirimID, ARD.Aciklama, RA.MasterReceteAdimID\n\t\t\tFrom\tIT01_MasterReceteAdimlari RA\n\t\t\t\t\tInner Join IT01_AdimReceteD ARD On ARD.AdimID = RA.AdimID\n\t\t\tWhere\tRA.MasterReceteID = @MasterReceteID\n\t\t) AS S\n\t\tON   S.MasterReceteID = T.MasterReceteID And S.AdimReceteDID = T.AdimReceteDID And S.SiraNo = T.SiraNo\n\t\tWHEN MATCHED  THEN UPDATE SET T.SiraNo = S.SiraNo, T.IstekNo = S.IstekNo,\n\t\t\t\t\t\t\t\t\t\tT.UrunTID = S.UrunTID, T.BirimMiktar = S.BirimMiktar, \n\t\t\t\t\t\t\t\t\t\tT.ReceteOlcuBirimID = S.ReceteOlcuBirimID, T.Aciklama = S.Aciklama,\n\t\t\t\t\t\t\t\t\t\tT.MasterReceteAdimID = S.MasterReceteAdimID,\n\t\t\t\t\t\t\t\t\t\tT.UpdateDate = GetDate()\n\t\tWHEN NOT MATCHED BY TARGET THEN \n\t\tINSERT (AdimReceteDID, MasterReceteID, MasterReceteAdimID, AdimID, SiraNo, IstekNo, UrunTID, BirimMiktar, ReceteOlcuBirimID, Aciklama, EklemeTipID, AddDate, AddUser) \n\t\t\tVALUES(S.AdimReceteDID, S.MasterReceteID, S.MasterReceteAdimID, S.AdimID, S.SiraNo, S.IstekNo, S.UrunTID, S.BirimMiktar, S.ReceteOlcuBirimID, S.Aciklama, 4, GetDate(), @PersonelID)\n\t\tWHEN NOT MATCHED BY SOURCE AND T.MasterReceteID = @MasterReceteID\n\t\tTHEN DELETE;"
}