{
  "id": "198ee65d-023a-481e-bdcb-50a81ddf406f",
  "prefix": "snp_SIADETAYDUZELT",
  "description": "",
  "body": "Declare @StokIslemAkisID int,@IslemAkisMID int\nDeclare c Cursor Local For\n\nSELECT SIA.StokIslemAkisID,IAM.IslemAkisMID \nFrom IT06_StoklarIslemAkis SIA \nInner JOIN  IT06_IslemAkisM IAM On IAM.IslemAkisMID = SIA.IslemAkisMID\n--Where SIA.StokIslemAkisID =17\n\t\t\nOpen c\nFetch Next From c Into @StokIslemAkisID,@IslemAkisMID\nWhile @@FETCH_STATUS = 0 Begin\n\n\t\t\t\tUpdate SIAPP \n\t\t\t\tSet  SIAPP.SiraNo = M.SiraNo,SIAPP.UrunDonusumu = M.UrunDonusumu,SIAPP.IsITUpdate = SIAPP.IsITUpdate\n\t\t\t\tFrom (\n\t\t\t\tSelect  IAM.IslemAkisMID,RD.SiraNo, RD.ProsesID, ISL.IslemID,RD.UrunDonusumu,ISL.IRN,RD.DRN\n\t\t\t\tFrom    IT06_IslemAkisM IAM\n\t\t\t\t\t\tINNER JOIN  IT05_RotaM RM On RM.RotaID = IAM.RotaID\n\t\t\t\t\t\tINNER JOIN (SELECT  RotaID,RotaDetayID,UrunDonusumu, ProsesID, SiraNo, ROW_NUMBER() Over (Partition By RotaID,ProsesID Order By SiraNo) DRN FROM IT05_RotaD) RD On RD.RotaID = RM.RotaID\n\t\t\t\t\t\tLEFT OUTER JOIN  (\tSELECT IAD.IslemAkisMID, Case When I.IslemTipID = 3/*FASON İŞLEM*/ Then I.FasonProsesID Else  I.ProsesID End ProsesID,I.IslemID ,ROW_NUMBER() Over (Partition By IAD.IslemAkisMID,I.ProsesID Order By IAD.SiraNo) IRN\n\t\t\t\t\t\t\t\t\t\t\tFrom IT06_IslemAkisD IAD\n\t\t\t\t\t\t\t\t\t\t\tInner JOIN IT06_Islemler I On I.IslemID = IAD.IslemID\n\t\t\t\t\t\t\t\t\t) ISL On  ISL.IslemAkisMID = IAM.IslemAkisMID And ISL.ProsesID = RD.ProsesID \n\t\t\t\t) M\n\t\t\t\tINNER JOIN IT06_StoklarIslemAkis_ProsesParam SIAPP On SIAPP.StokIslemAkisID = @StokIslemAkisID and SIAPP.ProsesID = M.ProsesID And ISNULL(SIAPP.IslemID,-1) = ISNULL(M.IslemID,-1) --And SIAPP.UrunDonusumu = M.UrunDonusumu\n\t\t\t\tWhere  M.IslemAkisMID = @IslemAkisMID  And M.DRN = ISNULL(M.IRN,1)  --Order By M.SiraNo\t\n\n\tFetch Next From c Into @StokIslemAkisID,@IslemAkisMID\nEnd\nClose c\nDeallocate c\n"
}