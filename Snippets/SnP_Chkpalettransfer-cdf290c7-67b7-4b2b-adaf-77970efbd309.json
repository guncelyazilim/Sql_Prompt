{
  "id": "cdf290c7-67b7-4b2b-adaf-77970efbd309",
  "prefix": "SnP_Chkpalettransfer",
  "description": "",
  "body": "Declare @DepoPalmSeriMID int, @PaletID int, @PersonelID int, @SPHedefTransferYeri Varchar(100), @SPPaletOlcu Varchar(50), @SPPaletTipID Int,\r\n        @SPPaletTipKodu Varchar(100), @SPDaraGr Decimal(9, 2),\r\n        /*Rapor yazdırma*/\r\n\r\n        @Tarih SmallDateTime, @EtiketID Int, @FirmaID int, @AmbarID int, @TrAmbarID int, @PBrutKg Decimal(18, 6), @PMT Decimal(18, 6), @PKg Decimal(18, 6),\r\n        @StokTipID int, @FisID int, @TransferFisTurID int\r\nSet @Tarih = dbo.DatetimeToDate(GETDATE())\r\nSet @TransferFisTurID = 31 /*NORMAL TRANSFER*/\r\nSet @TrAmbarID = 60 /*SEVKİYAT DEPO ya direkt Transfer olacak*/\r\nSet  @StokTipID  = 28\r\n\r\nSet @PersonelID  =1 \r\n\r\n/*60759*/\r\n\r\nDeclare c Cursor Local For\r\nSelect  Distinct P.PaletID, SA.AmbarID SAAmbarID, P.AmbarID PaletAmbarID\r\nFrom    IT08_SeriM SM\r\n        Inner Join IT06_StokAmbar SA On SA.SeriID = SM.SeriID\r\n        Inner Join IT01_Paletler P On P.PaletID = SM.PaletID\r\nWhere   P.Durumu = 4 And SA.AmbarID <> ISNULL(P.AmbarID, -1)\r\n\r\n\r\nOpen c\r\nFetch Next From c\r\nInto @PaletID, @AmbarID, @TrAmbarID\r\nWhile @@FETCH_STATUS = 0 Begin\r\n\r\n\r\n\r\n    Insert  IT06_HareketFisM (StokTipID, FisTarihi, FisiHazirlayanID, FirmaID, FisTurID, AmbarID, TrAmbarID)\r\n    Values (@StokTipID, @Tarih, @PersonelID, 2, @TransferFisTurID, @AmbarID, @TrAmbarID)\r\n    Set @FisID = SCOPE_IDENTITY()\r\n\r\n\r\n    Insert  IT06_HareketFisD (FisID, UrunID, FirmaID, IsEmriNo, SeriID, KaliteID, Miktar_Mt, Miktar_Kg, Miktar_Ad)\r\n    Select  @FisID, SA.UrunID, SA.FirmaID, SA.IsEmriNo, SA.SeriID, SA.KaliteID, SA.Miktar_Mt, SA.Miktar_Kg, SA.Miktar_Ad\r\n    From    IT08_SeriM SM\r\n            Inner Join IT06_StokAmbar SA On SA.SeriID = SM.SeriID\r\n    Where   SM.PaletID = @PaletID And SA.AmbarID <> @TrAmbarID\r\n\r\n\r\n    Update  IT01_Paletler Set   AmbarID = @TrAmbarID, IsITUpdate = IsITUpdate Where PaletID = @PaletID\r\n\r\n \r\n    Fetch Next From c\r\n    Into @PaletID, @AmbarID, @TrAmbarID\r\nEnd\r\nClose c\r\nDeallocate c\r\n\r\n"
}