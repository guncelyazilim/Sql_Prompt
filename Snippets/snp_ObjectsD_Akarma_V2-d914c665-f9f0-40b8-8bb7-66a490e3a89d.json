{
  "id": "d914c665-f9f0-40b8-8bb7-66a490e3a89d",
  "prefix": "snp_ObjectsD_Akarma_V2",
  "description": "",
  "body": "/*\nİşlevi : ObjectsD ayarlarını script olarak alıp aktarmaya yarar\nKullanımı : Aşağıdaki Script Kaynak Veri Tabanında ilgili View/tablo için çalıştırılır. Oluşan script hedef veri tabanında çalıştırılır.\nDİKKAT: Scipt almadan önce aşağıdaki ayarları yapın \n\t1. Results To text yap\n\t2. \"SSMS > Options > Query Results > SQL Server\" sayfasındaki \"Maximum number of characters displayed in each column\" alanınnı 20.000 gibi büyük bir sayı verin.\n*/\n\nSet NoCount On\n\n\nDeclare @Dunyanin_Enn_Uzun_Degisken_Adini_Yazmaya_Calisayim_Bakayim_Ne_Kadar_Oluyor_Halen_Yazabiliyorum_Gercekten_Cok_Ilginc_Ve_Gereksiz Varchar(100) \n= '$CURSOR$'\n\nPrint 'Set NoCount On '\nPrint 'If Object_Id(''tempdb..#Alanlar'') Is Not Null Drop Table #Alanlar\t' \nPrint 'Create Table #Alanlar(ITObjectName varchar(100), FieldName Varchar(40), FieldCaption Varchar(40), ShowSiraNo int, CaptionSize int, Type tinyint, NotInGrid tinyint, ITRequired tinyint, LField tinyint, LDataSet varchar(50), LKeyFields varchar(50), LLKeyFields varchar(50), LResultField varchar(50), LWhereText varchar(500), LOrderText varchar(500), LDetailDataSet varchar(50) , ITReadOnly TinyInt, ITVisible  TinyInt, ITDefValue Varchar(100) )'\n\n\n\n\nSelect  Concat('Insert #Alanlar (ITObjectName, FieldName, FieldCaption, ShowSiraNo, CaptionSize, Type, NotInGrid, ITRequired, LField, LDataSet, LKeyFields, LLKeyFields, LResultField, LWhereText, LOrderText, LDetailDataSet, ITReadOnly, ITVisible, ITDefValue)'+ CHAR(13) +\n\t\t' VALUES(''',OM.ITObjectName, ''',''', OD.FieldName, ''', ''', FieldCaption, ''', ', OD.ShowSiraNo, ', ', OD.CaptionSize, ', ', OD.Type, ', ', IsNull(OD.NotInGrid, 0), ', ', IsNull(OD.ITRequired, 0), ', ', \n\t\t ISNULL(OD.LField,0), ',''', OD.LDataSet, ''',''', OD.LKeyFields, ''',''', OD.LLKeyFields, ''',''', OD.LResultField, ''',''', OD.LWhereText, ''',''', OD.LOrderText, ''',''', OD.LDetailDataSet, ''', ',\n\t\t \n\t\t ISNULL(ROD.ITReadOnly,0) , ', ', ISNULL(ROD.ITVisible,0) , ', ''', ROD.ITDefValue, ''')')\nFrom\tIT15_ObjectsD OD \n\t\tInner Join IT15_ObjectsM OM On OM.ITObjectID = OD.ITObjectID\n\t\tLEFT OUTER JOIN IT15_RolObjectsM ROM On ROM.ITObjectID = OM.ITObjectID And ROM.RolID = 1 /* Güncel Rolünün Yetkileri alınır */\n\t\tLEFT OUTER JOIN IT15_RolObjectsD ROD On ROD.RolObjectMID = ROM.RolObjectMID And ROD.ITObjectDID = OD.ITObjectDID\nWhere\tOM.ITObjectName = @Dunyanin_Enn_Uzun_Degisken_Adini_Yazmaya_Calisayim_Bakayim_Ne_Kadar_Oluyor_Halen_Yazabiliyorum_Gercekten_Cok_Ilginc_Ve_Gereksiz\n\n\n\nPrint '\nDeclare @Adet int\n\nUpdate\tOD Set \n\t\tFieldCaption = A.FieldCaption, \n\t\tShowSiraNo = A.ShowSiraNo, \n\t\tCaptionSize = A.CaptionSize, \n\t\tType = A.Type,\n\t\tNotInGrid = A.NotInGrid,\n\t\tITRequired = A.ITRequired,\n\t\tLField = A.LField, \n\t\tLDataSet = A.LDataSet, \n\t\tLKeyFields = A.LKeyFields, \n\t\tLLKeyFields = A.LLKeyFields, \n\t\tLResultField = A.LResultField, \n\t\tLWhereText = A.LWhereText, \n\t\tLOrderText = A.LOrderText, \n\t\tLDetailDataSet = A.LDetailDataSet\nFrom\tIT15_ObjectsD OD \n\t\tInner Join IT15_ObjectsM OM On OM.ITObjectID = OD.ITObjectID\n\t\tInner Join #Alanlar A On OD.FieldName = A.FieldName COLLATE DATABASE_DEFAULT  And A.ITObjectName = OM.ITObjectName COLLATE DATABASE_DEFAULT \n\n\nSet @Adet = @@ROWCOUNT\n\nIf @Adet = 0 Raiserror(''Hiç Güncelleme yapılmadı. Muhtemelen bir yanlışlık var.'',16,1)\nElse Print Concat(@Adet, '' adet satır güncellendi.'')\n\n'\n\n\n\n\nPrint '\nInsert IT15_ObjectsD (ITObjectID, FieldName, FieldCaption, ShowSiraNo, CaptionSize, Type, NotInGrid, ITRequired, LField, LDataSet, LKeyFields, LLKeyFields, LResultField,\n       LWhereText, LOrderText, LDetailDataSet, FieldType)\n\nSELECT\tOM.ITObjectID, A.FieldName, A.FieldCaption, A.ShowSiraNo, A.CaptionSize, A.Type, A.NotInGrid, A.ITRequired, A.LField, A.LDataSet, A.LKeyFields,\n        A.LLKeyFields, A.LResultField, A.LWhereText, A.LOrderText, A.LDetailDataSet, ''varchar''\nFrom\t#Alanlar A\n\t\tINNER JOIN IT15_ObjectsM OM On OM.ITObjectName = A.ITObjectName Collate Database_Default\n\nWhere\tISNULL(A.LDataSet,'''') <> ''''\n\t\tAnd Not Exists(\n\t\t\tSELECT * FROM IT15_ObjectsD OD Where OD.ITObjectID = OM.ITObjectID And OD.LDataSet = A.LDataSet Collate Database_Default \n\t\t\tAnd OD.LKeyFields = A.LKeyFields Collate Database_Default And OD.LLKeyFields = A.LLKeyFields Collate Database_Default And OD.LResultField = A.LResultField Collate Database_Default\n\t\t)\n\nSet @Adet = @@ROWCOUNT\n\nIf @Adet > 0 Begin\t\n\tPrint Concat(''     '', @Adet, '' adet yeni lookup kolon yaratıldı. Tövbe.. oluştuldu.'')\n\n\t/*  Eğer yeni kolon eklendiyse yetkisi de verilir. */\n\tInsert  IT15_RolObjectsD(RolObjectMID, ITObjectDID, ITReadOnly, ITVisible, ITDefValue)\n\tSelect  ROM.RolObjectMID, OD.ITObjectDID, A.ITReadOnly, A.ITVisible, A.ITDefValue\n\tFrom    IT15_ObjectsD OD\n\t\t\tInner Join IT15_ObjectsM OM On OM.ITObjectID = OD.ITObjectID\n\t\t\tInner Join #Alanlar A On A.ITObjectName = OM.ITObjectName Collate Database_Default And A.FieldName = OD.FieldName Collate Database_Default\n\t\t\tInner Join IT15_RolObjectsM ROM On ROM.ITObjectID = OM.ITObjectID And  ROM.RolID = 1\n\tWhere   Not Exists (Select  * From  IT15_RolObjectsD ROD Where  ROD.RolObjectMID = ROM.RolObjectMID And ROD.ITObjectDID = OD.ITObjectDID)\n\t\n\tSet @Adet = @@ROWCOUNT\n\n\tPrint Concat(''     '', @Adet, '' adet yeni lookup için yetki verildi.'')\n\nEnd\n\n\n\n\n\n\n'\n\nPrint '\n\nUpdate  ROD\nSet     ROD.ITReadOnly = A.ITReadOnly, ROD.ITVisible = A.ITVisible, ROD.ITDefValue = A.ITDefValue\nFrom    IT15_ObjectsD OD\n        Inner Join IT15_RolObjectsD ROD On OD.ITObjectDID = ROD.ITObjectDID\n        Inner Join IT15_RolObjectsM ROM On ROD.RolObjectMID = ROM.RolObjectMID And ROM.RolID = 1 /* Sadece GUNCEL */\n        Inner Join IT15_ObjectsM OM On OM.ITObjectID = OD.ITObjectID\n\n        Inner Join #Alanlar A On OD.FieldName = A.FieldName COLLATE DATABASE_DEFAULT  And A.ITObjectName = OM.ITObjectName COLLATE DATABASE_DEFAULT\n\n\nSet @Adet = @@ROWCOUNT\n\nIf @Adet = 0 Raiserror(''Yetkilerde hiç güncelleme yapılmadı. Muhtemelen bir GUNCEL In yetkisi yok. Veya daha kötü birşeyler...'',16,1)\nElse Print Concat(@Adet,'' adet satır kolon yetkisi güncellendi.'')\n\n\n'"
}