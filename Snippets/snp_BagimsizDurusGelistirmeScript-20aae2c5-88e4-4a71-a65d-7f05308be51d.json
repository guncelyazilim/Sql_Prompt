{
  "id": "20aae2c5-88e4-4a71-a65d-7f05308be51d",
  "prefix": "snp_BagimsizDurusGelistirmeScript",
  "description": "",
  "body": "\r\nCreate PROCEDURE  SP60_BagimsizDurusEkle_TerbiyeStandart (\r\n    @MakinaID Int, @PersonelID Int, @DurusNedenID Int, @TPulseCikanStateID Int)\r\nAs\r\nSet NoCount On\r\n------SET ANSI_WARNINGS OFF\r\n\r\nBegin\r\n    Begin Try\r\n        Declare @NTPulseCikanStateID Int, @ArizaBitZaman DATETIME\r\n\r\n\t\t--Raiserror('MakinaID:%d  PersonelID:%d  DurusNedenID:%d  TPulseCikanStateID:%d', 16, 1, @MakinaID, @PersonelID, @DurusNedenID, @TPulseCikanStateID)\r\n\r\n\r\n        If ISNULL(@TPulseCikanStateID, 0) = 0 Begin\r\n            Insert  IT60_TPulseCikanState (TPulseCikanID, BasMt, BasZaman, PersonelID, MakinaID, PulseStateID)\r\n            Values (Null, 0, GETDATE(), @PersonelID, @MakinaID, @DurusNedenID)\r\n            Set @NTPulseCikanStateID = SCOPE_IDENTITY()\r\n        End\r\n        Else Begin\r\n            Update  TPCS\r\n            Set     TPCS.BitZaman = GETDATE(), TPCS.BitMt = 0, TPCS.Aktif = 0, TPCS.PersonelID = @PersonelID\r\n            From    IT60_TPulseCikanState TPCS\r\n            Where   TPCS.TPulseCikanStateID = @TPulseCikanStateID\r\n\r\n            Set @ArizaBitZaman = (Select    BitZaman From  IT60_TPulseCikanState Where TPulseCikanStateID = @TPulseCikanStateID)\r\n\r\n            Update  IT13_ArizaTalep Set ArizaBitisTarihi = @ArizaBitZaman Where DurusID = @TPulseCikanStateID\r\n\r\n            /* Makina duru≈üu eklenir.  */\r\n            Insert  IT60_PulseCikanState (PulseStateID, BasMt, BitMt, BasZaman, BitZaman, PersonelID, Aciklama, MakinaID, SeriID, ArizaTalepID)\r\n            Select  TPCS.PulseStateID, TPCS.BasMt, TPCS.BitMt, TPCS.BasZaman, TPCS.BitZaman, TPCS.PersonelID, TPCS.Aciklama, TPCS.MakinaID, Null,\r\n                    TPCS.ArizaTalepID\r\n            From    IT60_TPulseCikanState TPCS\r\n            --INNER JOIN IT60_TPulseCikan TPC On TPC.TPulseCikanID = TPCS.TPulseCikanID\r\n            Where   TPCS.TPulseCikanStateID = @TPulseCikanStateID\r\n\r\n            Delete  IT60_TPulseCikanState Where TPulseCikanStateID = @TPulseCikanStateID\r\n        End\r\n\r\n    End Try\r\n    Begin Catch\r\n        Declare @ITObjectName NVarchar(126)\r\n        Set @ITObjectName = OBJECT_NAME(@@PROCID)\r\n        Execute SP15_GenerateError @ITObjectName\r\n    End Catch\r\nEnd\r\nGo\r\nALTER TABLE IT60_PulseProgramM ADD BagimsizDurusSPName Varchar(50) --NULL|NOT NULL\r\nGo\r\n\r\nUpdate IT60_PulseProgramm Set BagimsizDurusSPName = 'SP60_BagimsizDurusEkle_TerbiyeStandart'\r\ngo\r\n\r\nAlter View PV60_DurusEkle_Terbiye\r\nAs\r\nSelect  PCS.TPulseCikanStateID, PCS.TPulseCikanID, PCS.PulseStateID, PCS.BasMt, PCS.BasZaman, PCS.PersonelID, PCS.MakinaBolumID, PCS.PulseCikanStateBolgeID,\r\n        PCS.MakinaID, PCS.Aciklama, dbo.F05_BitimSureText(99, ISNULL(PCS.BasZaman, GETDATE()), ISNULL(PCS.BitZaman, GETDATE()), 0) DurusSure,\r\n        P.PersonelAdi BasPersonelAdi, PS.PulseStateName DurusNedenKodu, M.MakinaNo\r\nFrom    IT60_TPulseCikanState PCS\r\n        Left Outer Join IT60_PulseState PS On PS.PulseStateID = PCS.PulseStateID\r\n        Left Outer Join dbo.IT01_Personel P On P.PersonelID = PCS.PersonelID\r\n\t\tLEFT OUTER JOIN IT01_Makinalar M On M.MakinaID = PCS.MakinaID\r\nGo"
}